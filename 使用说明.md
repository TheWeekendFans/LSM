# Pyramid LSM 晶圆对准引擎 - 使用与运行指南

本文档将指导您如何在 Windows 环境下编译并运行该项目。

## 1. 环境准备

本项目需要 **Microsoft Visual Studio C++ 生成工具 (Build Tools)** 来编译 C++ 代码。
我们在之前的步骤中已经确认您的环境安装了 Visual Studio 2022 Build Tools。

## 2. 一键编译与运行

我们为您准备了一个批处理脚本 `build.bat`，它可以自动配置环境变量、编译代码并运行测试。

**操作步骤：**

1.  打开文件资源管理器，进入项目目录：
    `g:\半导体offer\3`
2.  双击运行 `build.bat` 文件。
3.  或者，在命令行 (CMD 或 PowerShell) 中运行：
    ```cmd
    cd /d g:\半导体offer\3
    .\build.bat
    ```

**预期输出：**
脚本会自动执行以下步骤：
1.  Setting up environment... (配置 VS 编译环境)
2.  Compiling... (调用 `cl.exe` 编译代码)
3.  Running... (运行生成的 `PyramidLSM.exe`)

程序运行结束后，您将在屏幕上看到评估进度的输出（如 `Evaluating SNR=...`）。

## 3. 查看结果

程序运行完成后，会在当前目录下生成以下三个 CSV 结果文件，您可以使用 Excel 打开查看或绘制图表：

1.  **eval_snr.csv** (信噪比鲁棒性测试)
    -   展示了不同信噪比 (SNR) 下的匹配误差 (MeanError) 和标准差 (StdError)。
    -   *关键指标*：关注 `StdErrorX` 和 `StdErrorY`，数值越小表示精度越高。

2.  **eval_asymmetry.csv** (非对称性鲁棒性测试)
    -   展示了 Mark 不对称程度 (Asymmetry 0~0.25) 对匹配精度的影响。
    -   *关键观察*：随着 Asymmetry 增加，MeanError 是否会出现系统性偏差。

3.  **perf_speedup.csv** (性能测试)
    -   展示了开启 SIMD 加速前后的耗时对比。
    -   *TimeNoSIMD_ms*: 未开启加速的耗时。
    -   *TimeSIMD_ms*: 开启 AVX2 加速后的耗时。
    -   *Speedup*: 加速比 (通常 > 1.5x)。

## 4. 常见问题

**Q: 运行 `build.bat` 时提示找不到文件？**
A: 请确保您安装了 Visual Studio C++ Build Tools，并且脚本中的路径 `C:\Program Files (x86)\Microsoft Visual Studio\2022\BuildTools\VC\Auxiliary\Build\vcvars64.bat` 是正确的。如果您的安装路径不同，请右键编辑 `build.bat` 修改该路径。

**Q: 编译时出现乱码？**
A: 这是由于控制台编码问题，不影响程序功能。我们在编译选项中加入了 `/utf-8` 以尽量减少此类问题。

**Q: 如何手动编译？**
A: 如果您想手动编译，请先打开 "x64 Native Tools Command Prompt for VS 2022"，然后进入目录执行：
```cmd
cl.exe /EHsc /O2 /arch:AVX2 /openmp /utf-8 /I include src\*.cpp /Fe:PyramidLSM.exe
```
然后运行 `PyramidLSM.exe`。
